# MuFo Troubleshooting Guide\n\nThis guide helps resolve common issues when using MuFo for music library validation and organization.\n\n## 🚨 Common Issues & Solutions\n\n### 1. **Spotify Authentication Problems**\n\n#### **Error: \"Spotify API not authenticated\"**\n```powershell\n# Solution: Authenticate with Spotify\nConnect-Spotify\n\n# If using saved credentials\nConnect-Spotify -UseCache\n\n# Force new authentication\nConnect-Spotify -Force\n```\n\n#### **Error: \"Rate limit exceeded\"**\n```powershell\n# Solution: Use Preview mode with logging for large libraries\nInvoke-MuFo -Path \"C:\\Music\" -Preview -LogTo \"results.json\"\n\n# Then review and apply changes selectively\nInvoke-MuFo -ShowResults -LogTo \"results.json\" -MinScore 0.8\n```\n\n### 2. **TagLib-Sharp Installation Issues**\n\n#### **Error: \"TagLib-Sharp not found\"**\n```powershell\n# Solution: Install TagLib-Sharp\nInstall-TagLibSharp\n\n# If installation fails, try forcing reinstall\nInstall-TagLibSharp -Force\n\n# For all users (requires admin)\nInstall-TagLibSharp -Scope AllUsers\n```\n\n#### **Error: \"Could not load file or assembly 'TagLib-Sharp'\"**\n```powershell\n# Check if .NET Framework is compatible\n$PSVersionTable.PSVersion\n\n# Restart PowerShell session after installation\nExit\n# Then reopen and import module\nImport-Module .\\MuFo.psm1\n```\n\n### 3. **File Access and Permission Issues**\n\n#### **Error: \"Access to the path is denied\"**\n```powershell\n# Run PowerShell as administrator for system directories\n# Or use -WhatIf to check without making changes\nInvoke-MuFo -Path \"C:\\Music\" -WhatIf\n\n# For read-only analysis without tag writing\nInvoke-MuFo -Path \"C:\\Music\" -Preview  # Omit -FixTags\n```\n\n#### **Error: \"The process cannot access the file because it is being used\"**\n```powershell\n# Close media players and file explorers\n# Use Task Manager to end media player processes\n# Then retry the operation\n```\n\n### 4. **No Spotify Results Found**\n\n#### **Problem: \"NothingFromSpotify\" for valid albums**\n```powershell\n# Try broader search parameters\nInvoke-MuFo -Path \"C:\\Music\\Artist\" -IncludeSingles -IncludeCompilations\n\n# Lower confidence threshold\nInvoke-MuFo -Path \"C:\\Music\\Artist\" -ConfidenceThreshold 0.4\n\n# Check for special characters in folder names\nInvoke-MuFo -Path \"C:\\Music\\Artist\" -Verbose  # See search queries\n```\n\n#### **Classical Music Not Found**\n```powershell\n# Include compilations for classical releases\nInvoke-MuFo -Path \"C:\\Music\\Classical\" -IncludeCompilations -IncludeSingles\n\n# Try alternative artist naming\n# Check if composer is in folder name instead of performer\n```\n\n### 5. **Performance Issues**\n\n#### **Problem: Slow execution on large libraries**\n```powershell\n# Use exclusions to skip problematic folders\nInvoke-MuFo -Path \"C:\\Music\" -ExcludeFolders \"*_Archive\", \"*_Backup\", \"_*\"\n\n# Process in chunks\nInvoke-MuFo -Path \"C:\\Music\\A-E\" -LogTo \"results-1.json\"\nInvoke-MuFo -Path \"C:\\Music\\F-M\" -LogTo \"results-2.json\"\n# etc.\n```\n\n#### **Problem: High memory usage**\n```powershell\n# Use Preview mode to avoid keeping large datasets in memory\nInvoke-MuFo -Path \"C:\\Music\" -Preview\n\n# Restart PowerShell session between large operations\n```\n\n### 6. **Folder Structure Detection Issues**\n\n#### **Error: \"No artist folder found at specified level\"**\n```powershell\n# Check your folder structure\nGet-ChildItem \"C:\\Music\" -Directory | Select-Object Name\n\n# Adjust -ArtistAt parameter:\n# If structure is Music/Genre/Artist/Album:\nInvoke-MuFo -Path \"C:\\Music\" -ArtistAt 2D\n\n# If you're in an album folder:\nInvoke-MuFo -Path \"C:\\Music\\Artist\\Album\" -ArtistAt 1U\n```\n\n### 7. **Exclusion Pattern Issues**\n\n#### **Problem: Exclusions not working**\n```powershell\n# Test exclusion patterns\nInvoke-MuFo -ExcludedFoldersShow  # Display current exclusions\n\n# Use exact folder names for testing\nInvoke-MuFo -Path \"C:\\Music\" -ExcludeFolders \"ExactFolderName\" -Verbose\n\n# Check wildcard syntax:\n# '*_Live' not '_Live*' for folders ending with '_Live'\n```\n\n### 8. **Tag Enhancement Issues**\n\n#### **Problem: Tags not being written**\n```powershell\n# Ensure FixTags is enabled\nInvoke-MuFo -Path \"C:\\Music\" -IncludeTracks -FixTags -WhatIf\n\n# Check file permissions\nGet-Acl \"C:\\Music\\Artist\\Album\\track.mp3\"\n\n# Test on a single file first\nInvoke-MuFo -Path \"C:\\Music\\TestAlbum\" -IncludeTracks -FixTags -Verbose\n```\n\n#### **Problem: Classical music tags incorrect**\n```powershell\n# Use classical music optimization\nInvoke-MuFo -Path \"C:\\Music\\Classical\" -IncludeTracks -FixTags -OptimizeClassicalTags\n\n# Check composer detection\nInvoke-MuFo -Path \"C:\\Music\\Classical\\Album\" -IncludeTracks -ShowEverything\n```\n\n## 🔍 Diagnostic Commands\n\n### **Basic Health Check**\n```powershell\n# Test module loading\nGet-Module MuFo\n\n# Test Spotify connection\nConnect-Spotify -PassThru\n\n# Test TagLib-Sharp\nInstall-TagLibSharp -TestOnly\n```\n\n### **Detailed Analysis**\n```powershell\n# Maximum verbosity for troubleshooting\nInvoke-MuFo -Path \"C:\\Music\\ProblemArtist\" -Verbose -Debug -ShowEverything\n\n# Analyze specific album with full details\nInvoke-MuFo -Path \"C:\\Music\\Artist\\ProblemAlbum\" -IncludeTracks -ShowEverything\n```\n\n### **Results Analysis**\n```powershell\n# Save detailed results for analysis\nInvoke-MuFo -Path \"C:\\Music\" -LogTo \"debug-results.json\" -Preview\n\n# Review errors only\nInvoke-MuFo -ShowResults -LogTo \"debug-results.json\" -Action \"error\"\n\n# Review low-confidence matches\nInvoke-MuFo -ShowResults -LogTo \"debug-results.json\" -MinScore 0 | Where-Object Score -lt 0.6\n```\n\n## 🛠️ Advanced Troubleshooting\n\n### **Module Conflicts**\n```powershell\n# Check for conflicting modules\nGet-Module | Where-Object Name -like \"*Music*\"\nGet-Module | Where-Object Name -like \"*Spotify*\"\n\n# Remove conflicting modules\nRemove-Module ConflictingModule\nImport-Module .\\MuFo.psm1 -Force\n```\n\n### **PowerShell Environment**\n```powershell\n# Check PowerShell version (requires 7.3+)\n$PSVersionTable\n\n# Check execution policy\nGet-ExecutionPolicy\nSet-ExecutionPolicy RemoteSigned -Scope CurrentUser\n```\n\n### **Network and API Issues**\n```powershell\n# Test internet connectivity\nTest-NetConnection spotify.com -Port 443\n\n# Check if corporate firewall blocks Spotify API\nInvoke-WebRequest \"https://api.spotify.com\" -UseBasicParsing\n```\n\n## 📊 Performance Optimization\n\n### **For Large Libraries (>10,000 albums)**\n```powershell\n# 1. Use Preview mode first\nInvoke-MuFo -Path \"C:\\Music\" -Preview -LogTo \"full-analysis.json\"\n\n# 2. Review high-confidence matches only\nInvoke-MuFo -ShowResults -LogTo \"full-analysis.json\" -MinScore 0.8\n\n# 3. Apply changes to confident matches\nInvoke-MuFo -ShowResults -LogTo \"full-analysis.json\" -MinScore 0.8 -DoIt Automatic\n\n# 4. Manually review uncertain matches\nInvoke-MuFo -ShowResults -LogTo \"full-analysis.json\" -MinScore 0.4 | Where-Object Score -lt 0.8\n```\n\n### **Memory Management**\n```powershell\n# Process in batches\n$artists = Get-ChildItem \"C:\\Music\" -Directory\n$artists | ForEach-Object {\n    Write-Host \"Processing: $($_.Name)\"\n    Invoke-MuFo -Path $_.FullName -DoIt Smart -LogTo \"results-$($_.Name).json\"\n    [System.GC]::Collect()  # Force garbage collection\n}\n```\n\n## 📞 Getting Help\n\n### **Built-in Documentation**\n```powershell\n# Comprehensive help\nGet-Help Invoke-MuFo -Full\n\n# Parameter-specific help\nGet-Help Invoke-MuFo -Parameter FixTags\n\n# Examples for specific scenarios\nGet-Help Invoke-MuFo -Examples\n```\n\n### **Log Analysis**\n```powershell\n# Generate detailed logs for support\nInvoke-MuFo -Path \"C:\\Music\\ProblemArea\" -LogTo \"support-log.json\" -Verbose -Debug\n\n# Include system information\n$PSVersionTable | ConvertTo-Json | Out-File \"system-info.json\"\nGet-Module MuFo | ConvertTo-Json | Out-File \"module-info.json\"\n```\n\n### **Known Limitations**\n\n1. **Very long paths (>260 characters)** - Use shorter folder structures or PowerShell 7.3+\n2. **Special Unicode characters** - Some rare characters may affect Spotify search\n3. **Large audio files (>500MB)** - Automatically skipped for performance\n4. **Corrupted audio files** - Will be skipped with warnings\n5. **Network timeouts** - Retry with `-Verbose` to see connection issues\n\n### **If All Else Fails**\n\n1. **Restart PowerShell** - Fresh session often resolves module conflicts\n2. **Update modules** - `Update-Module Spotishell`, reinstall TagLib-Sharp\n3. **Check antivirus** - Ensure MuFo files aren't quarantined\n4. **Test with simple case** - Single artist/album to isolate the issue\n5. **Create minimal test case** - Use small test library to reproduce issue\n\n---\n\n**Remember**: When reporting issues, include:\n- PowerShell version (`$PSVersionTable`)\n- Error messages (exact text)\n- Example folder structure causing issues\n- Steps to reproduce the problem\n\nMost issues can be resolved by following this guide systematically! 🎵